<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ë¦¬ì˜ ëª¨í—˜</title>
    <style>
        body {
            font-family: 'Malgun Gothic', Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .game-container {
            background-color: #2d2d2d;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        .character-stats {
            background-color: #3a3a3a;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .stat {
            background-color: #4a4a4a;
            padding: 8px 12px;
            border-radius: 3px;
            font-weight: bold;
        }
        
        .story-text {
            background-color: #404040;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            min-height: 100px;
            font-size: 16px;
        }
        
        .event-image {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
            border: 1px solid #555;
            max-height: 200px;
            overflow: hidden;
        }
        
        .event-image img {
            width: 100%;
            max-width: 300px;
            height: 150px;
            object-fit: cover;
            border-radius: 5px;
            filter: sepia(20%) saturate(70%) hue-rotate(10deg) brightness(1.1);
        }
        
        .image-loading {
            color: #a0a0a0;
            font-style: italic;
        }
        
        .choices {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .choice-btn {
            background-color: #555;
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }
        
        .choice-btn:hover {
            background-color: #666;
        }
        
        .choice-btn:disabled {
            background-color: #333;
            color: #888;
            cursor: not-allowed;
        }
        
        .game-title {
            text-align: center;
            color: #ffd700;
            margin-bottom: 30px;
            font-size: 24px;
        }
        
        .inventory-btn {
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .inventory-btn:hover {
            background-color: #5a5a5a;
        }
        
        .inventory {
            background-color: #3a3a3a;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            border: 2px solid #555;
        }
        
        .inventory h3 {
            color: #ffd700;
            margin: 0 0 15px 0;
            text-align: center;
        }
        
        .inventory-items {
            background-color: #4a4a4a;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            min-height: 80px;
        }
        
        .item {
            background-color: #555;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 3px;
            display: inline-block;
            color: #e0e0e0;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            
            .game-container {
                padding: 20px;
            }
            
            .character-stats {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="game-title">ğŸ—¡ï¸ ë„ë¦¬ì˜ ëª¨í—˜ ğŸ—¡ï¸</h1>
        
        <div class="character-stats">
            <div class="stat">ì²´ë ¥: <span id="health">100</span>/100</div>
            <div class="stat">ê³¨ë“œ: <span id="gold">50</span></div>
            <div class="stat">ê²½í—˜ì¹˜: <span id="exp">0</span></div>
            <div class="stat inventory-btn" onclick="toggleInventory()">ğŸ’ ê°€ë°©</div>
        </div>
        
        <div class="inventory" id="inventory" style="display: none;">
            <h3>ì•„ì´í…œ ê°€ë°©</h3>
            <div class="inventory-items" id="inventory-items">
                ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.
            </div>
            <button class="choice-btn" onclick="toggleInventory()">ë‹«ê¸°</button>
        </div>
        
        <div class="event-image" id="event-image" style="display: none;"></div>
        
        <div class="story-text" id="story-text">
            ì–´ëŠ ë§ˆì„ì— ë„ë¦¬ë¼ëŠ” ëª¨í—˜ê°€ê°€ ì‚´ê³  ìˆì—ˆë‹¤. 
            ì–´ëŠë‚  ë„ë¦¬ëŠ” ë¶€ì™€ ëª…ì˜ˆë¥¼ ì–»ê¸° ìœ„í•œ ìƒˆë¡œìš´ ëª¨í—˜ì„ ë– ë‚˜ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤.
            ì§‘ì„ ë‚˜ì„œë©° ë°°ë‚­ì„ ë©”ê³  ê¸¸ì„ ê±·ê¸° ì‹œì‘í–ˆë‹¤.
        </div>
        
        <div class="choices" id="choices">
            <button class="choice-btn" onclick="startGame()">ëª¨í—˜ ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <script>
        // ê²Œì„ ìƒíƒœ
        let gameState = {
            health: 100,
            gold: 50,
            exp: 0,
            currentEvent: null,
            usedEvents: [],
            flags: {},
            items: {}
        };

        // ê²Œì„ ì´ë²¤íŠ¸ ë°ì´í„°
        const events = [
            {
                id: 'merchant',
                text: 'ë„ë¦¬ëŠ” ì—¬í–‰ ì¤‘ ëŠ™ì€ ìƒì¸ì„ ë§Œë‚¬ë‹¤.\n\nìƒì¸: "ì´ ì‹ ë¹„í•œ ë¬¼ì•½ì„ ì‚¬ì‹œê² ìŠµë‹ˆê¹Œ? ë‹¨ 30ê³¨ë“œì…ë‹ˆë‹¤."',
                imageQuery: 'old merchant watercolor fantasy bottles potions',
                choices: [
                    { text: 'ë¬¼ì•½ì„ ì‚°ë‹¤', cost: 30, effect: () => ({}), probability: 100, flag: 'bought_potion', item: 'healing_potion' },
                    { text: 'ì•ˆ ì‚°ë‹¤', effect: () => ({}), probability: 100 },
                    { text: 'ë¬¼ì•½ì„ ë¹¼ì•—ëŠ”ë‹¤ (ì„±ê³µí™•ë¥  50%)', effect: () => ({}), probability: 50, success: () => ({}), failure: () => ({ health: -10 }), flag: 'robbed_merchant', item: 'healing_potion' }
                ]
            },
            {
                id: 'children',
                text: 'ë„ë¦¬ëŠ” ì•„ì´ë“¤ì´ ë†€ì´ë¥¼ í•˜ëŠ” ê²ƒì„ ë°œê²¬í–ˆë‹¤.\n\nì•„ì´ë“¤ì´ ì¦ê²ê²Œ ê³µë†€ì´ë¥¼ í•˜ê³  ìˆë‹¤.',
                imageQuery: 'children playing watercolor happy kids ball game',
                choices: [
                    { text: 'í•¨ê»˜ ë†€ì•„ì¤€ë‹¤', effect: () => ({ exp: 10 }), probability: 100, flag: 'helped_children' },
                    { text: 'ê·¸ëƒ¥ ì§€ë‚˜ì¹œë‹¤', effect: () => ({}), probability: 100 },
                    { text: 'ë†€ì´ë¥¼ ë°©í•´í•œë‹¤', effect: () => ({ exp: -5, gold: 10 }), probability: 100, flag: 'bullied_children' }
                ]
            },
            {
                id: 'treasure',
                text: 'ë„ë¦¬ëŠ” ê¸¸ê°€ì—ì„œ ë°˜ì§ì´ëŠ” ë¬´ì–¸ê°€ë¥¼ ë°œê²¬í–ˆë‹¤.\n\në•…ì— ë¬»íŒ ì‘ì€ ë³´ë¬¼ìƒìê°€ ë³´ì¸ë‹¤.',
                imageQuery: 'treasure chest watercolor buried ground sparkling',
                choices: [
                    { text: 'ìƒìë¥¼ íŒë‹¤', effect: () => ({ gold: 25, exp: 5 }), probability: 100 },
                    { text: 'ë¬´ì‹œí•˜ê³  ì§€ë‚˜ê°„ë‹¤', effect: () => ({}), probability: 100 },
                    { text: 'ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ì¡°ì‚¬í•œë‹¤', effect: () => ({}), probability: 70, success: () => ({ gold: 50, exp: 10 }), failure: () => ({ health: -15 }) }
                ]
            },
            {
                id: 'angry_merchant',
                text: 'ë„ë¦¬ ì•ì— í™”ë‚œ ìƒì¸ì´ ë‚˜íƒ€ë‚¬ë‹¤!\n\nìƒì¸: "ë„¤ê°€ ë‚´ ë¬¼ì•½ì„ í›”ì³ê°„ ë„ë‘‘ì´êµ¬ë‚˜! ë³µìˆ˜í•˜ëŸ¬ ì™”ë‹¤!"',
                condition: () => gameState.flags.robbed_merchant,
                choices: [
                    { text: 'ì‚¬ê³¼í•œë‹¤', effect: () => ({ gold: -20, exp: 5 }), probability: 100 },
                    { text: 'ë„ë§ì¹œë‹¤ (ì„±ê³µí™•ë¥  60%)', effect: () => ({}), probability: 60, success: () => ({}), failure: () => ({ health: -20 }) },
                    { text: 'ë§ì„œ ì‹¸ìš´ë‹¤ (ì„±ê³µí™•ë¥  40%)', effect: () => ({}), probability: 40, success: () => ({ gold: 40, exp: 15 }), failure: () => ({ health: -30 }) }
                ]
            },
            {
                id: 'grateful_children',
                text: 'ë„ë¦¬ê°€ ì „ì— ë†€ì•„ì¤€ ì•„ì´ë“¤ì´ ë‹¬ë ¤ì™”ë‹¤!\n\nì•„ì´: "ë„ë¦¬! ì´ê±° ë“œë¦´ê²Œìš”!" ì•„ì´ê°€ ì‘ì€ ì„ ë¬¼ì„ ê±´ë„¸ë‹¤.',
                condition: () => gameState.flags.helped_children,
                choices: [
                    { text: 'ê³ ë§™ê²Œ ë°›ëŠ”ë‹¤', effect: () => ({ health: 15, exp: 5 }), probability: 100 },
                    { text: 'ì‚¬ì–‘í•œë‹¤', effect: () => ({ exp: 10 }), probability: 100 }
                ]
            },
            {
                id: 'forest_path',
                text: 'ë„ë¦¬ëŠ” ì–´ë‘ìš´ ìˆ²ê¸¸ì— ë“¤ì–´ì„°ë‹¤.\n\nê¸¸ì´ ë‘ ê°ˆë˜ë¡œ ë‚˜ë‰˜ì–´ì ¸ ìˆë‹¤.',
                choices: [
                    { text: 'ë°ì€ ê¸¸ë¡œ ê°„ë‹¤', effect: () => ({}), probability: 80, success: () => ({ exp: 5 }), failure: () => ({ health: -5 }) },
                    { text: 'ì–´ë‘ìš´ ê¸¸ë¡œ ê°„ë‹¤', effect: () => ({}), probability: 50, success: () => ({ gold: 30, exp: 10 }), failure: () => ({ health: -20 }) },
                    { text: 'ëŒì•„ê°„ë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'mysterious_wizard',
                text: 'ë„ë¦¬ëŠ” ì‹ ë¹„í•œ ë§ˆë²•ì‚¬ë¥¼ ë§Œë‚¬ë‹¤.\n\në§ˆë²•ì‚¬: "ì Šì€ ëª¨í—˜ê°€ì—¬, ì‹œí—˜ì„ ë°›ì•„ë³´ê² ëŠ”ê°€?"',
                choices: [
                    { text: 'ì‹œí—˜ì„ ë°›ëŠ”ë‹¤', effect: () => ({}), probability: 60, success: () => ({ health: 30, gold: 20, exp: 20 }), failure: () => ({ health: -15, exp: 5 }) },
                    { text: 'ì •ì¤‘íˆ ê±°ì ˆí•œë‹¤', effect: () => ({ exp: 3 }), probability: 100 },
                    { text: 'ë¬´ì‹œí•˜ê³  ì§€ë‚˜ê°„ë‹¤', effect: () => ({ health: -10 }), probability: 100 }
                ]
            },
            {
                id: 'tavern',
                text: 'ë„ë¦¬ëŠ” ì‹œëŒë²…ì í•œ ì—¬ê´€ì— ë„ì°©í–ˆë‹¤.\n\nì—¬ê´€ ì£¼ì¸ì´ ë°˜ê°‘ê²Œ ë§ì•„ì¤€ë‹¤.',
                imageQuery: 'medieval tavern watercolor cozy inn warm light',
                choices: [
                    { text: 'ì‹ì‚¬ë¥¼ í•œë‹¤ (20ê³¨ë“œ)', cost: 20, effect: () => ({ health: 25 }), probability: 100 },
                    { text: 'ì •ë³´ë¥¼ ìˆ˜ì§‘í•œë‹¤', effect: () => ({ exp: 8 }), probability: 100 },
                    { text: 'ë„ë°•ì„ í•œë‹¤ (30ê³¨ë“œ)', cost: 30, effect: () => ({}), probability: 50, success: () => ({ gold: 60 }), failure: () => ({}) }
                ]
            },
            {
                id: 'bandits',
                text: 'ë„ë¦¬ ì•ì— ì‚°ì ë“¤ì´ ë‚˜íƒ€ë‚¬ë‹¤!\n\nì‚°ì : "ì§€ë‚˜ê°€ë ¤ë©´ í†µí–‰ë£Œë¥¼ ë‚´ë†”!"',
                imageQuery: 'bandits robbers watercolor medieval dangerous',
                choices: [
                    { text: 'ëˆì„ ì¤€ë‹¤ (25ê³¨ë“œ)', cost: 25, effect: () => ({}), probability: 100 },
                    { text: 'ì‹¸ìš´ë‹¤ (ì„±ê³µí™•ë¥  45%)', effect: () => ({}), probability: 45, success: () => ({ gold: 35, exp: 15 }), failure: () => ({ health: -25, gold: -15 }) },
                    { text: 'ì„¤ë“í•œë‹¤ (ì„±ê³µí™•ë¥  30%)', effect: () => ({}), probability: 30, success: () => ({ exp: 12 }), failure: () => ({ health: -20 }) }
                ]
            },
            {
                id: 'injured_traveler',
                text: 'ë„ë¦¬ëŠ” ê¸¸ê°€ì— ë‹¤ì¹œ ì—¬í–‰ìë¥¼ ë°œê²¬í–ˆë‹¤.\n\nì—¬í–‰ì: "ë„ì™€ì£¼ì„¸ìš”... ë‹¤ë¦¬ë¥¼ ë‹¤ì³¤ì–´ìš”."',
                choices: [
                    { text: 'ì¹˜ë£Œí•´ì¤€ë‹¤', effect: () => ({ exp: 12, health: -5 }), probability: 100, flag: 'helped_traveler' },
                    { text: 'ë¬¼ì•½ì„ ì¤€ë‹¤', condition: () => gameState.items.healing_potion > 0, effect: () => ({ exp: 20 }), probability: 100, useItem: 'healing_potion' },
                    { text: 'ì§€ë‚˜ê°„ë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'grateful_traveler',
                text: 'ë„ë¦¬ê°€ ì „ì— ë„ì™€ì¤€ ì—¬í–‰ìê°€ ë‚˜íƒ€ë‚¬ë‹¤!\n\nì—¬í–‰ì: "ë‹¹ì‹  ë•ë¶„ì— ì‚´ì•˜ìŠµë‹ˆë‹¤. ì´ ë³´ë‹µì„ ë°›ì•„ì£¼ì„¸ìš”."',
                condition: () => gameState.flags.helped_traveler,
                choices: [
                    { text: 'ë³´ìƒì„ ë°›ëŠ”ë‹¤', effect: () => ({ gold: 40, exp: 10 }), probability: 100 },
                    { text: 'ì‚¬ì–‘í•œë‹¤', effect: () => ({ exp: 15 }), probability: 100 }
                ]
            },
            {
                id: 'magic_shop',
                text: 'ë„ë¦¬ëŠ” ì‹ ë¹„í•œ ë§ˆë²• ìƒì ì„ ë°œê²¬í–ˆë‹¤.\n\në§ˆë²•ì‚¬: "ì–´ì„œì˜¤ì„¸ìš”! íŠ¹ë³„í•œ ë¬¼ê±´ë“¤ì„ íŒë§¤í•˜ê³  ìˆìŠµë‹ˆë‹¤."',
                imageQuery: 'magic shop watercolor wizard potions mystical',
                choices: [
                    { text: 'ì²´ë ¥ ë¬¼ì•½ì„ ì‚°ë‹¤ (40ê³¨ë“œ)', cost: 40, effect: () => ({}), probability: 100, item: 'healing_potion' },
                    { text: 'í–‰ìš´ì˜ ë¶€ì ì„ ì‚°ë‹¤ (60ê³¨ë“œ)', cost: 60, effect: () => ({}), probability: 100, item: 'lucky_charm' },
                    { text: 'ë‘˜ëŸ¬ë³´ê¸°ë§Œ í•œë‹¤', effect: () => ({ exp: 5 }), probability: 100 }
                ]
            },
            {
                id: 'sick_tree',
                text: 'ë„ë¦¬ëŠ” ì‹œë“¤ì–´ê°€ëŠ” ê±°ëŒ€í•œ ë‚˜ë¬´ë¥¼ ë°œê²¬í–ˆë‹¤.\n\në‚˜ë¬´ê°€ ë³‘ë“¤ì–´ ë³´ì¸ë‹¤. ë­”ê°€ ë„ì›€ì´ í•„ìš”í•´ ë³´ì¸ë‹¤.',
                choices: [
                    { text: 'ë¬¼ì•½ì„ ë¿Œë ¤ì¤€ë‹¤', condition: () => gameState.items.healing_potion > 0, effect: () => ({ exp: 25, gold: 30 }), probability: 100, useItem: 'healing_potion' },
                    { text: 'ë‚˜ë¬´ë¥¼ ì¡°ì‚¬í•œë‹¤', effect: () => ({ exp: 8 }), probability: 100 },
                    { text: 'ì§€ë‚˜ì¹œë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'lucky_find',
                text: 'ë„ë¦¬ëŠ” í—˜í•œ ì ˆë²½ ê¸¸ì„ ê±·ê³  ìˆë‹¤.\n\në°œë°‘ì´ ìœ„í—˜í•´ ë³´ì´ì§€ë§Œ ì €í¸ì— ë³´ë¬¼ì´ ë³´ì¸ë‹¤.',
                choices: [
                    { text: 'ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ê°„ë‹¤', effect: () => ({}), probability: 40, success: () => ({ gold: 50, exp: 15 }), failure: () => ({ health: -25 }) },
                    { text: 'í–‰ìš´ì˜ ë¶€ì ì„ ì‚¬ìš©í•œë‹¤', condition: () => gameState.items.lucky_charm > 0, effect: () => ({ gold: 80, exp: 20 }), probability: 100, useItem: 'lucky_charm' },
                    { text: 'í¬ê¸°í•œë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'mysterious_cave',
                text: 'ë„ë¦¬ëŠ” ì–´ë‘ìš´ ë™êµ´ì„ ë°œê²¬í–ˆë‹¤.\n\në™êµ´ ì•ˆì—ì„œ ì‹ ë¹„í•œ ë¹›ì´ ìƒˆì–´ë‚˜ì˜¤ê³  ìˆë‹¤.',
                choices: [
                    { text: 'ë™êµ´ì— ë“¤ì–´ê°„ë‹¤', effect: () => ({}), probability: 60, success: () => ({ gold: 45, exp: 18 }), failure: () => ({ health: -20 }) },
                    { text: 'ë¬¼ì•½ì„ ë§ˆì‹œê³  ë“¤ì–´ê°„ë‹¤', condition: () => gameState.items.healing_potion > 0, effect: () => ({ gold: 60, exp: 25 }), probability: 100, useItem: 'healing_potion' },
                    { text: 'ë˜ëŒì•„ê°„ë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'lost_child',
                text: 'ë„ë¦¬ëŠ” ìš¸ê³  ìˆëŠ” ì•„ì´ë¥¼ ë§Œë‚¬ë‹¤.\n\nì•„ì´: "ì—„ë§ˆë¥¼ ì°¾ì„ ìˆ˜ê°€ ì—†ì–´ìš”..."',
                choices: [
                    { text: 'ì•„ì´ë¥¼ ë„ì™€ì¤€ë‹¤', effect: () => ({ exp: 15, health: -10 }), probability: 100, flag: 'helped_lost_child' },
                    { text: 'ë¬¼ì•½ì„ ì£¼ë©° ìœ„ë¡œí•œë‹¤', condition: () => gameState.items.healing_potion > 0, effect: () => ({ exp: 20 }), probability: 100, useItem: 'healing_potion' },
                    { text: 'ì§€ë‚˜ì¹œë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'grateful_mother',
                text: 'ë„ë¦¬ê°€ ë„ì™€ì¤€ ì•„ì´ì˜ ì–´ë¨¸ë‹ˆê°€ ë‚˜íƒ€ë‚¬ë‹¤!\n\nì–´ë¨¸ë‹ˆ: "ì œ ì•„ì´ë¥¼ ë„ì™€ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!"',
                condition: () => gameState.flags.helped_lost_child,
                choices: [
                    { text: 'ë³´ìƒì„ ë°›ëŠ”ë‹¤', effect: () => ({ gold: 35, exp: 12 }), probability: 100, item: 'healing_potion' },
                    { text: 'ì‚¬ì–‘í•œë‹¤', effect: () => ({ exp: 18 }), probability: 100 }
                ]
            },
            {
                id: 'ancient_ruins',
                text: 'ë„ë¦¬ëŠ” ê³ ëŒ€ ìœ ì ì„ ë°œê²¬í–ˆë‹¤.\n\nìœ ì  ì•ì— "ìš©ê¸° ìˆëŠ” ìë§Œì´ ë³´ë¬¼ì„ ì–»ìœ¼ë¦¬ë¼"ëŠ” ê¸€ì´ ìƒˆê²¨ì ¸ ìˆë‹¤.',
                choices: [
                    { text: 'ìœ ì ì— ë“¤ì–´ê°„ë‹¤', effect: () => ({}), probability: 50, success: () => ({ gold: 70, exp: 30 }), failure: () => ({ health: -30 }) },
                    { text: 'í–‰ìš´ì˜ ë¶€ì ê³¼ í•¨ê»˜ ë“¤ì–´ê°„ë‹¤', condition: () => gameState.items.lucky_charm > 0, effect: () => ({ gold: 100, exp: 40 }), probability: 100, useItem: 'lucky_charm' },
                    { text: 'ëŒì•„ê°„ë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'potion_seller',
                text: 'ë„ë¦¬ëŠ” ê¸¸ê°€ì—ì„œ ë¬¼ì•½ì„ íŒŒëŠ” í• ë¨¸ë‹ˆë¥¼ ë§Œë‚¬ë‹¤.\n\ní• ë¨¸ë‹ˆ: "ì Šì€ì´, ì¢‹ì€ ë¬¼ì•½ì´ ìˆëŠ”ë° ì‚¬ê² ë‚˜?"',
                choices: [
                    { text: 'ë¬¼ì•½ì„ ì‚°ë‹¤ (35ê³¨ë“œ)', cost: 35, effect: () => ({}), probability: 100, item: 'healing_potion' },
                    { text: 'í• ë¨¸ë‹ˆì™€ ëŒ€í™”í•œë‹¤', effect: () => ({ exp: 8 }), probability: 100 },
                    { text: 'ì§€ë‚˜ê°„ë‹¤', effect: () => ({}), probability: 100 }
                ]
            },
            {
                id: 'bridge_troll',
                text: 'ë„ë¦¬ëŠ” ë‹¤ë¦¬ ì•ì—ì„œ ê±°ëŒ€í•œ íŠ¸ë¡¤ì„ ë§Œë‚¬ë‹¤!\n\níŠ¸ë¡¤: "ë‹¤ë¦¬ë¥¼ ê±´ë„ˆë ¤ë©´ ë‚˜ì™€ ë‚´ê¸°ë¥¼ í•´ì•¼ í•œë‹¤!"',
                choices: [
                    { text: 'ë‚´ê¸°ë¥¼ ë°›ì•„ë“¤ì¸ë‹¤', effect: () => ({}), probability: 50, success: () => ({ gold: 60, exp: 20 }), failure: () => ({ health: -20, gold: -30 }) },
                    { text: 'í–‰ìš´ì˜ ë¶€ì ì„ ì‚¬ìš©í•œë‹¤', condition: () => gameState.items.lucky_charm > 0, effect: () => ({ gold: 90, exp: 25 }), probability: 100, useItem: 'lucky_charm' },
                    { text: 'ëŒì•„ê°„ë‹¤', effect: () => ({}), probability: 100 }
                ]
            }
        ];

        function updateStats() {
            document.getElementById('health').textContent = gameState.health;
            document.getElementById('gold').textContent = gameState.gold;
            document.getElementById('exp').textContent = gameState.exp;
            updateInventoryDisplay();
        }
        
        async function loadEventImage(imageQuery) {
            const eventImageDiv = document.getElementById('event-image');
            
            if (!imageQuery) {
                eventImageDiv.style.display = 'none';
                return;
            }
            
            eventImageDiv.style.display = 'block';
            eventImageDiv.innerHTML = '<div class="image-loading">ì´ë¯¸ì§€ ë¡œë”© ì¤‘...</div>';
            
            try {
                // Unsplash API ë¬´ë£Œ ë²„ì „ ì‚¬ìš© (API í‚¤ ì—†ì´)
                const query = encodeURIComponent(imageQuery);
                const imageUrl = `https://source.unsplash.com/300x150/?${query}`;
                
                const img = new Image();
                img.onload = () => {
                    eventImageDiv.innerHTML = `<img src="${imageUrl}" alt="${imageQuery}">`;
                };
                img.onerror = () => {
                    eventImageDiv.innerHTML = '<div class="image-loading">ì´ë¯¸ì§€ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
                };
                img.src = imageUrl;
                
            } catch (error) {
                eventImageDiv.innerHTML = '<div class="image-loading">ì´ë¯¸ì§€ ë¡œë”© ì‹¤íŒ¨</div>';
            }
        }
        
        function updateInventoryDisplay() {
            const inventoryItems = document.getElementById('inventory-items');
            const items = gameState.items;
            
            if (Object.keys(items).length === 0 || Object.values(items).every(count => count === 0)) {
                inventoryItems.innerHTML = 'ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤.';
                return;
            }
            
            let itemsHtml = '';
            if (items.healing_potion > 0) {
                itemsHtml += `<div class="item">ğŸ§ª ì²´ë ¥ ë¬¼ì•½ x${items.healing_potion}</div>`;
            }
            if (items.lucky_charm > 0) {
                itemsHtml += `<div class="item">ğŸ€ í–‰ìš´ì˜ ë¶€ì  x${items.lucky_charm}</div>`;
            }
            
            inventoryItems.innerHTML = itemsHtml;
        }
        
        function toggleInventory() {
            const inventory = document.getElementById('inventory');
            if (inventory.style.display === 'none') {
                inventory.style.display = 'block';
                updateInventoryDisplay();
            } else {
                inventory.style.display = 'none';
            }
        }

        function getRandomEvent() {
            // ì¡°ê±´ì„ ë§Œì¡±í•˜ê³  ì•„ì§ ì‚¬ìš©ë˜ì§€ ì•Šì€ ì´ë²¤íŠ¸ë§Œ í•„í„°ë§
            const availableEvents = events.filter(event => {
                // ì´ë¯¸ ì‚¬ìš©ëœ ì´ë²¤íŠ¸ëŠ” ì œì™¸
                if (gameState.usedEvents.includes(event.id)) {
                    return false;
                }
                
                // ì¡°ê±´ì´ ìˆëŠ” ì´ë²¤íŠ¸ëŠ” ì¡°ê±´ í™•ì¸
                if (event.condition) {
                    return event.condition();
                }
                
                return true;
            });
            
            // ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ê°€ ì—†ìœ¼ë©´ ê²Œì„ ì¢…ë£Œ
            if (availableEvents.length === 0) {
                showGameEnd();
                return null;
            }
            
            return availableEvents[Math.floor(Math.random() * availableEvents.length)];
        }

        function startGame() {
            showRandomEvent();
        }

        function showRandomEvent() {
            const event = getRandomEvent();
            if (!event) return; // ê²Œì„ì´ ì¢…ë£Œëœ ê²½ìš°
            
            gameState.currentEvent = event;
            gameState.usedEvents.push(event.id);
            
            // ì´ë¯¸ì§€ ë¡œë“œ
            if (event.imageQuery) {
                loadEventImage(event.imageQuery);
            } else {
                document.getElementById('event-image').style.display = 'none';
            }
            
            document.getElementById('story-text').textContent = event.text;
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            event.choices.forEach((choice, index) => {
                // ì¡°ê±´ì´ ìˆëŠ” ì„ íƒì§€ëŠ” ì¡°ê±´ í™•ì¸
                if (choice.condition && !choice.condition()) {
                    return;
                }
                
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice.text;
                button.onclick = () => makeChoice(choice);
                
                if (choice.cost && gameState.gold < choice.cost) {
                    button.disabled = true;
                    button.textContent += ' (ê³¨ë“œ ë¶€ì¡±)';
                }
                
                choicesDiv.appendChild(button);
            });
        }

        function makeChoice(choice) {
            let result = '';
            let effects = {};
            
            if (choice.cost && gameState.gold >= choice.cost) {
                gameState.gold -= choice.cost;
                effects = choice.effect();
            } else if (!choice.cost) {
                if (choice.probability === 100) {
                    effects = choice.effect();
                } else {
                    const success = Math.random() * 100 <= choice.probability;
                    if (success && choice.success) {
                        effects = choice.success();
                        result = 'ì„±ê³µ! ';
                    } else if (!success && choice.failure) {
                        effects = choice.failure();
                        result = 'ì‹¤íŒ¨... ';
                    } else {
                        effects = choice.effect();
                    }
                }
            }
            
            // í”Œë˜ê·¸ ì„¤ì •
            if (choice.flag) {
                gameState.flags[choice.flag] = true;
            }
            
            Object.keys(effects).forEach(key => {
                if (key === 'health') {
                    gameState[key] = Math.min(100, gameState[key] + effects[key]);
                } else {
                    gameState[key] += effects[key];
                }
            });
            
            // ì•„ì´í…œ ì¶”ê°€
            if (choice.item) {
                gameState.items[choice.item] = (gameState.items[choice.item] || 0) + 1;
            }
            
            // ì•„ì´í…œ ì‚¬ìš©
            if (choice.useItem) {
                gameState.items[choice.useItem] = Math.max(0, (gameState.items[choice.useItem] || 0) - 1);
            }
            
            if (gameState.health <= 0) {
                gameState.health = 0;
                showGameOver();
                return;
            }
            
            updateStats();
            
            let resultText = result;
            if (effects.health > 0) resultText += `ì²´ë ¥ì´ ${effects.health} íšŒë³µë˜ì—ˆë‹¤. `;
            if (effects.health < 0) resultText += `ì²´ë ¥ì´ ${Math.abs(effects.health)} ê°ì†Œí–ˆë‹¤. `;
            if (effects.gold > 0) resultText += `${effects.gold} ê³¨ë“œë¥¼ ì–»ì—ˆë‹¤. `;
            if (effects.gold < 0) resultText += `${Math.abs(effects.gold)} ê³¨ë“œë¥¼ ìƒì—ˆë‹¤. `;
            if (effects.exp > 0) resultText += `${effects.exp} ê²½í—˜ì¹˜ë¥¼ ì–»ì—ˆë‹¤. `;
            if (effects.exp < 0) resultText += `${Math.abs(effects.exp)} ê²½í—˜ì¹˜ë¥¼ ìƒì—ˆë‹¤. `;
            
            setTimeout(() => {
                document.getElementById('story-text').textContent = resultText + '\n\në„ë¦¬ëŠ” ê³„ì†í•´ì„œ ëª¨í—˜ì„ ì´ì–´ê°”ë‹¤...';
                
                setTimeout(() => {
                    showRandomEvent();
                }, 2000);
            }, 1000);
        }

        function showGameOver() {
            document.getElementById('story-text').textContent = 'ë„ë¦¬ì˜ ì²´ë ¥ì´ ë°”ë‹¥ë‚¬ë‹¤...\n\nê²Œì„ ì˜¤ë²„!';
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            const restartBtn = document.createElement('button');
            restartBtn.className = 'choice-btn';
            restartBtn.textContent = 'ë‹¤ì‹œ ì‹œì‘í•˜ê¸°';
            restartBtn.onclick = () => {
                gameState = { health: 100, gold: 50, exp: 0, currentEvent: null, usedEvents: [], flags: {}, items: {} };
                updateStats();
                document.getElementById('story-text').textContent = 'ë„ë¦¬ëŠ” ìƒˆë¡œìš´ ëª¨í—˜ì„ ë– ë‚˜ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤. ì§‘ì„ ë‚˜ì„œë©° ë°°ë‚­ì„ ë©”ê³  ê¸¸ì„ ê±·ê¸° ì‹œì‘í–ˆë‹¤.';
                choicesDiv.innerHTML = '<button class="choice-btn" onclick="startGame()">ëª¨í—˜ ì‹œì‘í•˜ê¸°</button>';
            };
            
            choicesDiv.appendChild(restartBtn);
        }

        function getEnding() {
            const { health, gold, exp, flags, items } = gameState;
            
            // ì•„ì´í…œ ê¸°ë°˜ íŠ¹ë³„ ì—”ë”©ë“¤
            if (items.healing_potion >= 3 && items.lucky_charm >= 2) {
                return {
                    title: 'ğŸ’ ìˆ˜ì§‘ê°€ ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” í¬ê·€í•œ ì•„ì´í…œë“¤ì„ ëª¨ìœ¼ëŠ” ê²ƒì— íŠ¹ë³„í•œ ì¬ëŠ¥ì„ ë³´ì˜€ë‹¤. ì´ì œ ê·¸ëŠ” ì „ì„¤ì ì¸ ë³´ë¬¼ ì‚¬ëƒ¥ê¾¼ìœ¼ë¡œ ì•Œë ¤ì ¸ ìˆë‹¤.',
                    emoji: 'ğŸ’¼'
                };
            }
            
            if (items.healing_potion >= 5) {
                return {
                    title: 'ğŸ’Š ì—°ê¸ˆìˆ ì‚¬ ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ìˆ˜ë§ì€ ë¬¼ì•½ì„ ëª¨ìœ¼ë©° ì—°ê¸ˆìˆ ì˜ ë¹„ë°€ì„ ê¹¨ë‹¬ì•˜ë‹¤. ì´ì œ ê·¸ëŠ” ë§ˆì„ì˜ ìœ„ëŒ€í•œ ì—°ê¸ˆìˆ ì‚¬ê°€ ë˜ì—ˆë‹¤.',
                    emoji: 'âš—ï¸'
                };
            }
            
            if (items.lucky_charm >= 3) {
                return {
                    title: 'ğŸ€ í–‰ìš´ì•„ ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” í–‰ìš´ì˜ ë¶€ì ë“¤ì„ ëª¨ìœ¼ë©° ì§„ì •í•œ í–‰ìš´ì„ ì†ì— ë„£ì—ˆë‹¤. ì•ìœ¼ë¡œ ê·¸ì—ê²ŒëŠ” ì¢‹ì€ ì¼ë§Œ ì¼ì–´ë‚  ê²ƒì´ë‹¤.',
                    emoji: 'ğŸŒˆ'
                };
            }
            
            // íŠ¹ë³„í•œ ì¡°ê±´ë“¤ì„ ë¨¼ì € í™•ì¸
            if (flags.robbed_merchant && flags.bullied_children) {
                return {
                    title: 'ğŸŒ‘ ì•…ì—­ ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ì•…í•œ í–‰ë™ì„ ì¼ì‚¼ì•„ ë§ˆì„ ì‚¬ëŒë“¤ì—ê²Œ ë¯¸ì›€ë°›ê²Œ ë˜ì—ˆë‹¤. í•˜ì§€ë§Œ ë•Œë¡œëŠ” ì•…ì—­ë„ í•„ìš”í•˜ë‹¤ëŠ” ê²ƒì„ ê¹¨ë‹¬ì•˜ë‹¤.',
                    emoji: 'ğŸ˜ˆ'
                };
            }
            
            if (flags.helped_children && flags.helped_traveler && flags.helped_lost_child) {
                return {
                    title: 'ğŸ‘‘ ì„±ì¸ ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ìˆ˜ë§ì€ ì‚¬ëŒë“¤ì„ ë„ìš°ë©° ë§ˆì„ì˜ ì„±ì¸ìœ¼ë¡œ ì¶”ì•™ë°›ê²Œ ë˜ì—ˆë‹¤. ê·¸ì˜ ì„ í–‰ì€ ì „ì„¤ì´ ë˜ì–´ í›„ì„¸ì— ì „í•´ì¡Œë‹¤.',
                    emoji: 'ğŸ‘¼'
                };
            }
            
            // ìŠ¤íƒ¯ ê¸°ë°˜ ì—”ë”©
            if (gold >= 200) {
                return {
                    title: 'ğŸ’° ë¶€ì ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ëª¨í—˜ì„ í†µí•´ ë§‰ëŒ€í•œ ë¶€ë¥¼ ì¶•ì í–ˆë‹¤. ì´ì œ ê·¸ëŠ” ë§ˆì„ì˜ ê°€ì¥ ë¶€ìœ í•œ ìƒì¸ì´ ë˜ì–´ í¸ì•ˆí•œ ì‚¶ì„ ì‚´ê²Œ ë˜ì—ˆë‹¤.',
                    emoji: 'ğŸ’'
                };
            }
            
            if (exp >= 150) {
                return {
                    title: 'ğŸ“š í˜„ì ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ìˆ˜ë§ì€ ê²½í—˜ì„ í†µí•´ ì§€í˜œë¥¼ ì–»ì—ˆë‹¤. ì´ì œ ê·¸ëŠ” ë§ˆì„ì˜ í˜„ìê°€ ë˜ì–´ ì Šì€ ëª¨í—˜ê°€ë“¤ì—ê²Œ ì¡°ì–¸ì„ í•´ì£¼ê³  ìˆë‹¤.',
                    emoji: 'ğŸ§™â€â™‚ï¸'
                };
            }
            
            if (health >= 90 && exp >= 80 && gold >= 100) {
                return {
                    title: 'âš”ï¸ ì˜ì›… ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ê· í˜•ì¡íŒ ì„±ì¥ì„ ì´ë£¨ì–´ ì§„ì •í•œ ì˜ì›…ì´ ë˜ì—ˆë‹¤. ê·¸ì˜ ì´ë¦„ì€ ëª¨ë“  ì´ë“¤ì˜ ì…ì— ì˜¤ë¥´ë‚´ë¦°ë‹¤.',
                    emoji: 'ğŸ¦¸â€â™‚ï¸'
                };
            }
            
            if (health <= 30) {
                return {
                    title: 'ğŸ¥ ìƒì¡´ì ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ìœ„í—˜í•œ ëª¨í—˜ì„ ê²ªìœ¼ë©° ê°„ì‹ íˆ ì‚´ì•„ë‚¨ì•˜ë‹¤. ë¹„ë¡ ìƒì²˜íˆ¬ì„±ì´ì§€ë§Œ ì†Œì¤‘í•œ ê²½í—˜ì„ ì–»ì—ˆë‹¤.',
                    emoji: 'ğŸ©¹'
                };
            }
            
            if (gold <= 30 && exp <= 50) {
                return {
                    title: 'ğŸŒ± ì´ˆì‹¬ì ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ì•„ì§ ì´ˆë³´ ëª¨í—˜ê°€ë‹¤. í•˜ì§€ë§Œ ëª¨ë“  ìœ„ëŒ€í•œ ì˜ì›…ë„ ì‘ì€ ì‹œì‘ì—ì„œ ì¶œë°œí•œë‹¤ëŠ” ê²ƒì„ ìŠì§€ ë§ì.',
                    emoji: 'ğŸŒ¿'
                };
            }
            
            // ê¸°ë³¸ ì—”ë”©
            const totalScore = health + gold + (exp * 2);
            if (totalScore >= 300) {
                return {
                    title: 'ğŸŒŸ ì „ì„¤ ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ì „ì„¤ì ì¸ ëª¨í—˜ê°€ê°€ ë˜ì—ˆë‹¤. ê·¸ì˜ ì´ì•¼ê¸°ëŠ” ì˜ì›íˆ ê¸°ì–µë  ê²ƒì´ë‹¤.',
                    emoji: 'âœ¨'
                };
            } else if (totalScore >= 200) {
                return {
                    title: 'ğŸ–ï¸ ìˆ™ë ¨ì ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” ìˆ™ë ¨ëœ ëª¨í—˜ê°€ë¡œ ì„±ì¥í–ˆë‹¤. ì´ì œ ë” í° ëª¨í—˜ì´ ê·¸ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆë‹¤.',
                    emoji: 'ğŸ…'
                };
            } else {
                return {
                    title: 'ğŸš¶â€â™‚ï¸ í‰ë²”í•œ ì—”ë”©',
                    description: 'ë„ë¦¬ëŠ” í‰ë²”í•˜ì§€ë§Œ ì˜ë¯¸ìˆëŠ” ëª¨í—˜ì„ ë§ˆì³¤ë‹¤. ë•Œë¡œëŠ” í‰ë²”í•¨ë„ í•˜ë‚˜ì˜ ì¶•ë³µì´ë‹¤.',
                    emoji: 'ğŸ˜Š'
                };
            }
        }

        function showGameEnd() {
            const ending = getEnding();
            const totalScore = gameState.health + gameState.gold + (gameState.exp * 2);
            
            document.getElementById('story-text').textContent = 
                `ë„ë¦¬ì˜ ëª¨í—˜ì´ ëë‚¬ë‹¤!\n\n` +
                `${ending.emoji} ${ending.title}\n\n` +
                `${ending.description}\n\n` +
                `=== ìµœì¢… ê²°ê³¼ ===\n` +
                `ì²´ë ¥: ${gameState.health}\n` +
                `ê³¨ë“œ: ${gameState.gold}\n` +
                `ê²½í—˜ì¹˜: ${gameState.exp}\n` +
                `ì´ì : ${totalScore}ì `;
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            const restartBtn = document.createElement('button');
            restartBtn.className = 'choice-btn';
            restartBtn.textContent = 'ìƒˆë¡œìš´ ëª¨í—˜ ì‹œì‘í•˜ê¸°';
            restartBtn.onclick = () => {
                gameState = { health: 100, gold: 50, exp: 0, currentEvent: null, usedEvents: [], flags: {}, items: {} };
                updateStats();
                document.getElementById('story-text').textContent = 'ë„ë¦¬ëŠ” ìƒˆë¡œìš´ ëª¨í—˜ì„ ë– ë‚˜ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤. ì§‘ì„ ë‚˜ì„œë©° ë°°ë‚­ì„ ë©”ê³  ê¸¸ì„ ê±·ê¸° ì‹œì‘í–ˆë‹¤.';
                choicesDiv.innerHTML = '<button class="choice-btn" onclick="startGame()">ëª¨í—˜ ì‹œì‘í•˜ê¸°</button>';
            };
            
            choicesDiv.appendChild(restartBtn);
        }
    </script>
</body>
</html>
